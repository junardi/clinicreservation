import Head from 'next/head';
import { useEffect, useState } from 'react';
import { Container, Row, Col, Form, Button, Table } from 'react-bootstrap';

import { useSession, getSession } from "next-auth/react";
import { useRouter } from 'next/router';
import { Fragment } from 'react';
import { toast } from 'react-toastify';


const setupDate = (dateString) => {
  const dateObj = new Date('2023-02-01T16:00:00.000Z');
  //console.log(dateObj);

  const month = dateObj.getMonth() + 1; 
  const day = dateObj.getDate();
  const year = dateObj.getFullYear();

  const date = year + "-" + ("0" + month).slice(-2) + "-" + ("0" + day).slice(-2);

  return date;

};

function UserComponent({userId}) {

  const { data: session, status } = useSession();

  const [reserveData, setReserveData] = useState({});

  const [recall, setRecall] = useState(false);


  useEffect(() => {
    const getReservations = async() => {
      try {
        const fetchData = await fetch('/api/patients/' + userId, {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json'
          }
        });

        const jsonData = await fetchData.json();

        setReserveData(jsonData);
        console.log(jsonData);
        return jsonData;
       

      } catch(error) {
        console.log(error);
        return error;
      }
    };

    getReservations();
  }, [userId, recall]);


  return (
    <>
      <Head>
        <title>Admin - Child mapping information system</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <Container>
        <Row>
          <Col>

            <br />
            <h3>Your Appointment Details</h3>
            <br />

            { reserveData && reserveData.data &&
            <Table striped hover>
              <thead>
                <tr>
                  <th>Patient Name</th>
                  <th>Address</th>
                  <th>Contact Number</th>
                  <th>Gender</th>
                  <th>Age</th>
                  <th>Email</th>
                  <th>Date</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
              {
                reserveData.data.map((el, index) => {
                  return(
                    <tr key={el.userId}>
                      <td>{el.patientName}</td>
                      <td>{el.patientAddress}</td>
                      <td>{el.contactNumber}</td>
                      <td>{el.gender}</td>
                      <td>{el.age}</td>
                      <td>{el.emailAddress}</td>
                      <td>{setupDate(el.date)}</td>
                      <td>{el.status}</td>
                    </tr>
                  )
                })
              }
            
              </tbody>
            </Table>
            }

            <br />
            <p className='text-center'><strong>Prescription:</strong> {reserveData.data[0].prescription}</p>
            
          </Col>
        </Row>
      </Container>
      
    </>

  )

};


export default UserComponent;